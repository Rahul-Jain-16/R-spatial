<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Using Spatial Data with R</title>
  <meta name="description" content="Workshop materials for Using Spatial Data with R">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="Using Spatial Data with R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Workshop materials for Using Spatial Data with R" />
  <meta name="github-repo" content="cengel/R-spatial" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Using Spatial Data with R" />
  
  <meta name="twitter:description" content="Workshop materials for Using Spatial Data with R" />
  

<meta name="author" content="Claudia A Engel">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="index.html">
<link rel="next" href="spatialops.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.2/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/Proj4Leaflet-1.0.1/proj4-compressed.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.0/leaflet.js"></script>
<script src="libs/leaflet-providers-1.1.17/leaflet-providers.js"></script>
<script src="libs/leaflet-providers-plugin-2.0.0/leaflet-providers-plugin.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Using Spatial Data with R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites and Preparations</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#references"><i class="fa fa-check"></i>References</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction to spatial data in R</a><ul>
<li class="chapter" data-level="1.1" data-path="intro.html"><a href="intro.html#conceptualizing-spatial-vector-objects-in-r"><i class="fa fa-check"></i><b>1.1</b> Conceptualizing spatial vector objects in R</a><ul>
<li class="chapter" data-level="1.1.1" data-path="intro.html"><a href="intro.html#the-sp-package"><i class="fa fa-check"></i><b>1.1.1</b> The <code>sp</code> package</a></li>
<li class="chapter" data-level="1.1.2" data-path="intro.html"><a href="intro.html#the-sf-package"><i class="fa fa-check"></i><b>1.1.2</b> The <code>sf</code> package</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="intro.html"><a href="intro.html#creating-a-spatial-object-from-a-latlon-table"><i class="fa fa-check"></i><b>1.2</b> Creating a spatial object from a lat/lon table</a></li>
<li class="chapter" data-level="1.3" data-path="intro.html"><a href="intro.html#loading-shape-files-into-r"><i class="fa fa-check"></i><b>1.3</b> Loading shape files into R</a><ul>
<li class="chapter" data-level="1.3.1" data-path="intro.html"><a href="intro.html#how-to-work-with-rgdal"><i class="fa fa-check"></i><b>1.3.1</b> How to work with <code>rgdal</code></a></li>
<li class="chapter" data-level="1.3.2" data-path="intro.html"><a href="intro.html#how-to-do-this-in-sf"><i class="fa fa-check"></i><b>1.3.2</b> How to do this in <code>sf</code></a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="intro.html"><a href="intro.html#raster-data-in-r"><i class="fa fa-check"></i><b>1.4</b> Raster data in R</a><ul>
<li class="chapter" data-level="1.4.1" data-path="intro.html"><a href="intro.html#rasterstack-vs-rasterbrick-in-r"><i class="fa fa-check"></i><b>1.4.1</b> RasterStack vs RasterBrick in R</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="spatialops.html"><a href="spatialops.html"><i class="fa fa-check"></i><b>2</b> Spatial data manipulation in R</a><ul>
<li class="chapter" data-level="2.1" data-path="spatialops.html"><a href="spatialops.html#attribute-join"><i class="fa fa-check"></i><b>2.1</b> Attribute Join</a></li>
<li class="chapter" data-level="2.2" data-path="spatialops.html"><a href="spatialops.html#reprojecting"><i class="fa fa-check"></i><b>2.2</b> Reprojecting</a></li>
<li class="chapter" data-level="2.3" data-path="spatialops.html"><a href="spatialops.html#points-in-polygons"><i class="fa fa-check"></i><b>2.3</b> Points in Polygons</a></li>
<li class="chapter" data-level="2.4" data-path="spatialops.html"><a href="spatialops.html#select-polygons-by-location"><i class="fa fa-check"></i><b>2.4</b> Select Polygons by Location</a><ul>
<li class="chapter" data-level="2.4.1" data-path="spatialops.html"><a href="spatialops.html#using-the-sp-package"><i class="fa fa-check"></i><b>2.4.1</b> Using the <code>sp</code> package</a></li>
<li class="chapter" data-level="2.4.2" data-path="spatialops.html"><a href="spatialops.html#using-the-sf-package"><i class="fa fa-check"></i><b>2.4.2</b> Using the <code>sf</code> package</a></li>
<li class="chapter" data-level="2.4.3" data-path="spatialops.html"><a href="spatialops.html#sp---sf-comparison"><i class="fa fa-check"></i><b>2.4.3</b> <code>sp</code> - <code>sf</code> comparison</a></li>
<li class="chapter" data-level="2.4.4" data-path="spatialops.html"><a href="spatialops.html#raster-operations"><i class="fa fa-check"></i><b>2.4.4</b> <code>raster</code> operations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mapping.html"><a href="mapping.html"><i class="fa fa-check"></i><b>3</b> Making Maps in R</a><ul>
<li class="chapter" data-level="3.1" data-path="mapping.html"><a href="mapping.html#choropleth-mapping-with-spplot"><i class="fa fa-check"></i><b>3.1</b> Choropleth mapping with <code>spplot</code></a></li>
<li class="chapter" data-level="3.2" data-path="mapping.html"><a href="mapping.html#plotting-simple-features-sf-with-plot"><i class="fa fa-check"></i><b>3.2</b> Plotting simple features (<code>sf</code>) with <code>plot</code></a></li>
<li class="chapter" data-level="3.3" data-path="mapping.html"><a href="mapping.html#choropleth-mapping-with-ggplot2"><i class="fa fa-check"></i><b>3.3</b> Choropleth mapping with <code>ggplot2</code></a></li>
<li class="chapter" data-level="3.4" data-path="mapping.html"><a href="mapping.html#adding-basemaps-with-ggmap"><i class="fa fa-check"></i><b>3.4</b> Adding basemaps with <code>ggmap</code></a></li>
<li class="chapter" data-level="3.5" data-path="mapping.html"><a href="mapping.html#choropleth-with-tmap"><i class="fa fa-check"></i><b>3.5</b> Choropleth with <code>tmap</code></a></li>
<li class="chapter" data-level="3.6" data-path="mapping.html"><a href="mapping.html#web-mapping-with-leaflet"><i class="fa fa-check"></i><b>3.6</b> Web mapping with <code>leaflet</code></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Using Spatial Data with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro" class="section level1">
<h1><span class="header-section-number">Chapter 1</span> Introduction to spatial data in R</h1>
<blockquote>
<p>Learning Objectives</p>
<ul>
<li>Create point, line, and polygon shapefiles as <code>sp</code> and <code>sf</code> objects.</li>
<li>Read shapefiles into <code>sp</code> and <code>sf</code> objects</li>
<li>Examine <code>sp</code> and <code>sf</code> objects</li>
<li>Read GeoTiff single and multiband into a <code>raster</code> object.</li>
<li>Examine <code>raster</code> objects</li>
</ul>
</blockquote>
<hr />
<div id="conceptualizing-spatial-vector-objects-in-r" class="section level2">
<h2><span class="header-section-number">1.1</span> Conceptualizing spatial vector objects in R</h2>
<p>In vector GIS we deal with, points, lines, and polygons, like so:</p>
<p><img src="R-spatial_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<blockquote>
<h3>
Challenge
</h3>
<p>Discuss with your neighbor: What information do we need to store in order to define points, lines, polygons in geographic space?</p>
</blockquote>
<p>There are currently two main approaches in R to handle geographic vector data:</p>
<div id="the-sp-package" class="section level3">
<h3><span class="header-section-number">1.1.1</span> The <code>sp</code> package</h3>
<p>The first package to provide classes and methods for spatial data types in R is called <a href="https://cran.r-project.org/package=sp"><code>sp</code></a><a href="#fn1" class="footnoteRef" id="fnref1"><sup>1</sup></a>. Development of the <code>sp</code> package began in the early 2000s in an attempt to standardize how spatial data would be treated in R and to allow for better interoperability between different analysis packages that use spatial data. The package (first release on CRAN in 2005) provides classes and methods to create <em>points</em>, <em>lines</em>, <em>polygons</em>, and <em>grids</em> and to operate on them. About 350 of the spatial analysis packages use the spatial data types that are implemented in <code>sp</code> i.e. they “depend” on the <code>sp</code> package and many more are indirectly dependent.</p>
<p>The foundational structure for any spatial object in <code>sp</code> is the <code>Spatial</code> class. It has two “slots” (<a href="http://stackoverflow.com/a/4714080">new-style S4 class objects in R have pre-defined components called slots</a>):</p>
<ul>
<li><p>a <strong>bounding box</strong></p></li>
<li><p>a <strong>CRS class object</strong> to define the Coordinate Reference System</p></li>
</ul>
<p>This basic structure is then extended, depending on the characteristics of the spatial object (point, line, polygon).</p>
<p>To build up a spatial object in <code>sp</code> we could follow these steps:</p>
<blockquote>
<p>I. Create geometric objects (topology)</p>
</blockquote>
<p><strong>Points</strong> (which may have 2 or 3 dimensions) are the most basic spatial data objects. They are generated out of either a single coordinate or a set of coordinates, like a two-column matrix or a dataframe with a column for latitude and one for longitude.<br />
<strong>Lines</strong> are generated out of <code>Line</code> objects. A <code>Line</code> object is a spaghetti collection of 2D coordinates<a href="#fn2" class="footnoteRef" id="fnref2"><sup>2</sup></a> and is generated out of a two-column matrix or a dataframe with a column for latitude and one for longitude. A <code>Lines</code> object is a <strong>list</strong> of one or more <code>Line</code> objects, for example all the contours at a single elevation.<br />
<strong>Polygons</strong> are generated out of <code>Polygon</code> objects. A <code>Polygon</code> object is a spaghetti collection of 2D coordinates with equal first and last coordinates and is generated out of a two-column matrix or a dataframe with a column for latitude and one for longitude. A <code>Polygons</code> object is a <strong>list</strong> of one or more <code>Polygon</code> objects, for example islands belonging to the same country.</p>
<p>See here for a very simple example for how to create a <code>Line</code> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ln1 &lt;-<span class="st"> </span><span class="kw">Line</span>(<span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">6</span>), <span class="dt">ncol=</span><span class="dv">2</span>))
<span class="kw">str</span>(ln1)</code></pre></div>
<pre><code>#&gt; Formal class &#39;Line&#39; [package &quot;sp&quot;] with 1 slot
#&gt;   ..@ coords: num [1:3, 1:2] 0.286 0.733 0.433 0.203 0.244 ...</code></pre>
<p>See here for a very simple example for how to create a <code>Lines</code> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lns &lt;-<span class="st"> </span><span class="kw">Lines</span>(<span class="kw">list</span>(ln1), <span class="dt">ID =</span> <span class="kw">c</span>(<span class="st">&quot;hwy1&quot;</span>)) <span class="co"># this contains just one Line!</span>
<span class="kw">str</span>(lns)</code></pre></div>
<pre><code>#&gt; Formal class &#39;Lines&#39; [package &quot;sp&quot;] with 2 slots
#&gt;   ..@ Lines:List of 1
#&gt;   .. ..$ :Formal class &#39;Line&#39; [package &quot;sp&quot;] with 1 slot
#&gt;   .. .. .. ..@ coords: num [1:3, 1:2] 0.286 0.733 0.433 0.203 0.244 ...
#&gt;   ..@ ID   : chr &quot;hwy1&quot;</code></pre>
<blockquote>
<ol start="2" style="list-style-type: upper-roman">
<li>Create spatial objects <code>Spatial*</code> object (<code>*</code> stands for Points, Lines, or Polygons).</li>
</ol>
</blockquote>
<p>This step adds the bounding box (automatically) and the slot for the Coordinate Reference System or CRS (which needs to be filled with a value manually). <code>SpatialPoints</code> can be directly generated out of the coordinates. <code>SpatialLines</code> and <code>SpatialPolygons</code> objects are generated using lists of <code>Lines</code> or <code>Polygons</code> objects respectively (more below).</p>
<p>See here for how to create a <code>SpatialLines</code> object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sp_lns &lt;-<span class="st"> </span><span class="kw">SpatialLines</span>(<span class="kw">list</span>(lns))
<span class="kw">str</span>(sp_lns)</code></pre></div>
<pre><code>#&gt; Formal class &#39;SpatialLines&#39; [package &quot;sp&quot;] with 3 slots
#&gt;   ..@ lines      :List of 1
#&gt;   .. ..$ :Formal class &#39;Lines&#39; [package &quot;sp&quot;] with 2 slots
#&gt;   .. .. .. ..@ Lines:List of 1
#&gt;   .. .. .. .. ..$ :Formal class &#39;Line&#39; [package &quot;sp&quot;] with 1 slot
#&gt;   .. .. .. .. .. .. ..@ coords: num [1:3, 1:2] 0.286 0.733 0.433 0.203 0.244 ...
#&gt;   .. .. .. ..@ ID   : chr &quot;hwy1&quot;
#&gt;   ..@ bbox       : num [1:2, 1:2] 0.286 0.203 0.733 0.701
#&gt;   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
#&gt;   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
#&gt;   .. .. ..$ : chr [1:2] &quot;min&quot; &quot;max&quot;
#&gt;   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
#&gt;   .. .. ..@ projargs: chr NA</code></pre>
<blockquote>
<ol start="3" style="list-style-type: upper-roman">
<li>Add attributes (<em>Optional</em>:)</li>
</ol>
</blockquote>
<p>Add a data frame with attribute data, which will turn your <code>Spatial*</code> object into a <code>Spatial*DataFrame</code> object. The points in a <code>SpatialPoints</code> object may be associated with a row of attributes to create a <code>SpatialPointsDataFrame</code> object. The coordinates and attributes may, but do not have to be keyed to each other using ID values.<br />
<code>SpatialLinesDataFrame</code> and <code>SpatialPolygonsDataFrame</code> objects are defined using <code>SpatialLines</code> and <code>SpatialPolygons</code> objects and data frames. The ID fields are here required to match the data frame row names.</p>
<p>See here for how to create a <code>SpatialLinesDataframe</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dfr &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">id =</span> <span class="st">&quot;hwy1&quot;</span>, <span class="dt">use =</span> <span class="st">&quot;road&quot;</span>, <span class="dt">cars_per_hour =</span> <span class="dv">10</span>) <span class="co"># note how we use the ID from above!</span>
sp_lns_dfr &lt;-<span class="st"> </span><span class="kw">SpatialLinesDataFrame</span>(sp_lns, dfr, <span class="dt">match.ID =</span> <span class="st">&quot;id&quot;</span>)
<span class="kw">str</span>(sp_lns_dfr)</code></pre></div>
<pre><code>#&gt; Formal class &#39;SpatialLinesDataFrame&#39; [package &quot;sp&quot;] with 4 slots
#&gt;   ..@ data       :&#39;data.frame&#39;:  1 obs. of  3 variables:
#&gt;   .. ..$ id           : Factor w/ 1 level &quot;hwy1&quot;: 1
#&gt;   .. ..$ use          : Factor w/ 1 level &quot;road&quot;: 1
#&gt;   .. ..$ cars_per_hour: num 10
#&gt;   ..@ lines      :List of 1
#&gt;   .. ..$ :Formal class &#39;Lines&#39; [package &quot;sp&quot;] with 2 slots
#&gt;   .. .. .. ..@ Lines:List of 1
#&gt;   .. .. .. .. ..$ :Formal class &#39;Line&#39; [package &quot;sp&quot;] with 1 slot
#&gt;   .. .. .. .. .. .. ..@ coords: num [1:3, 1:2] 0.286 0.733 0.433 0.203 0.244 ...
#&gt;   .. .. .. ..@ ID   : chr &quot;hwy1&quot;
#&gt;   ..@ bbox       : num [1:2, 1:2] 0.286 0.203 0.733 0.701
#&gt;   .. ..- attr(*, &quot;dimnames&quot;)=List of 2
#&gt;   .. .. ..$ : chr [1:2] &quot;x&quot; &quot;y&quot;
#&gt;   .. .. ..$ : chr [1:2] &quot;min&quot; &quot;max&quot;
#&gt;   ..@ proj4string:Formal class &#39;CRS&#39; [package &quot;sp&quot;] with 1 slot
#&gt;   .. .. ..@ projargs: chr NA</code></pre>
<p>A number of spatial methods are available for the classes in <code>sp</code>. Among the ones I use more frequently are:</p>
<table style="width:94%;">
<colgroup>
<col width="18%" />
<col width="76%" />
</colgroup>
<thead>
<tr class="header">
<th>function</th>
<th>and what it does</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>bbox()</code></td>
<td>returns the bounding box coordinates</td>
</tr>
<tr class="even">
<td><code>proj4string()</code></td>
<td>sets or retrieves projection attributes using the CRS object.</td>
</tr>
<tr class="odd">
<td><code>CRS()</code></td>
<td>creates an object of class of coordinate reference system arguments</td>
</tr>
<tr class="even">
<td><code>spplot()</code></td>
<td>plots a separate map of all the attributes unless specified otherwise</td>
</tr>
<tr class="odd">
<td><code>coordinates()</code></td>
<td>set or retrieve the spatial coordinates. For spatial polygons it returns the centroids.</td>
</tr>
<tr class="even">
<td><code>over(a, b)</code></td>
<td>used for example to retrieve the polygon or grid indices on a set of points</td>
</tr>
<tr class="odd">
<td><code>spsample()</code></td>
<td>sampling of spatial points within the spatial extent of objects</td>
</tr>
</tbody>
</table>
</div>
<div id="the-sf-package" class="section level3">
<h3><span class="header-section-number">1.1.2</span> The <code>sf</code> package</h3>
<p>The second package, first released on CRAN in late October 2016, is called <a href="https://cran.r-project.org/package=sf"><code>sf</code></a><a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a>. It implements a formal standard called <a href="https://en.wikipedia.org/wiki/Simple_Features">“Simple Features”</a> that specifies a storage and access model of spatial geometries (point, line, polygon). A feature geometry is called simple when it consists of points connected by straight line pieces, and does not intersect itself. This standard has been adopted widely, not only by spatial databases such as PostGIS, but also more recent standards such as GeoJSON.</p>
<p>If you work with PostGis or GeoJSON you may have come across the <a href="https://en.wikipedia.org/wiki/Well-known_text">WKT (well-known text)</a> format, for example like these:</p>
<div class="figure"><span id="fig:wkt-primitives"></span>
<img src="img/wkt_primitives.png" alt="Well-Known-Text Geometry primitives  (wikipedia)" width="100%" />
<p class="caption">
Figure 1.1: Well-Known-Text Geometry primitives (wikipedia)
</p>
</div>
<div class="figure"><span id="fig:wkt-multipart"></span>
<img src="img/wkt_multipart.png" alt="Well-Known-Text Multipart geometries (wikipedia)" width="100%" />
<p class="caption">
Figure 1.2: Well-Known-Text Multipart geometries (wikipedia)
</p>
</div>
<p><code>sf</code> implements this standard natively in R. Data are structured and conceptualized very differently from the <code>sp</code> approach.</p>
<p>In <code>sf</code> spatial objects are stored as a simple data frame with a special column that contains the information for the geographic coordinates. That special column is a list with the same length as the number of rows in the data frame. Each of the individual list elements then can be of any length needed to hold the coordinates that correspond to an individual feature.</p>
<p>To create a spatial object manually the basic steps would be:</p>
<blockquote>
<p>I. Create geometric objects (topology)</p>
</blockquote>
<p>Geometric objects (simple features) can be created from a numeric vector, matrix or a list with the coordinates. They are called <code>sfg</code> objects for Simple Feature Geometry.</p>
<p>See here for an example of how a LINESTRING <code>sfg</code> object is created:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">lnstr_sfg &lt;-<span class="st"> </span><span class="kw">st_linestring</span>(<span class="kw">matrix</span>(<span class="kw">runif</span>(<span class="dv">6</span>), <span class="dt">ncol=</span><span class="dv">2</span>)) 
<span class="kw">class</span>(lnstr_sfg)</code></pre></div>
<pre><code>#&gt; [1] &quot;XY&quot;         &quot;LINESTRING&quot; &quot;sfg&quot;</code></pre>
<blockquote>
<ol start="2" style="list-style-type: upper-roman">
<li>Combine all individual single feature objects for the special column.</li>
</ol>
</blockquote>
<p>In order to work our way towards a data frame for all features we create what is called an <code>sfc</code> object with all individual features, which stands for Simple Feature Collection. The <code>sfc</code> object also holds the bounding box and the projection information.</p>
<p>See here for an example of how a <code>sfc</code> object is created:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(lnstr_sfc &lt;-<span class="st"> </span><span class="kw">st_sfc</span>(lnstr_sfg)) <span class="co"># just one feature here</span></code></pre></div>
<pre><code>#&gt; Geometry set for 1 feature 
#&gt; geometry type:  LINESTRING
#&gt; dimension:      XY
#&gt; bbox:           xmin: 0.02397248 ymin: 0.1355328 xmax: 0.3947794 ymax: 0.9765345
#&gt; epsg (SRID):    NA
#&gt; proj4string:    NA</code></pre>
<pre><code>#&gt; LINESTRING (0.02397248 0.1355328, 0.3947794 0.9...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(lnstr_sfc) </code></pre></div>
<pre><code>#&gt; [1] &quot;sfc_LINESTRING&quot; &quot;sfc&quot;</code></pre>
<blockquote>
<ol start="3" style="list-style-type: upper-roman">
<li>Add attributes.</li>
</ol>
</blockquote>
<p>We now combine the dataframe with the attributes and the simple feature collection. See here how its done.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">(lnstr_sf &lt;-<span class="st"> </span><span class="kw">st_sf</span>(dfr , lnstr_sfc))</code></pre></div>
<pre><code>#&gt; Simple feature collection with 1 feature and 3 fields
#&gt; geometry type:  LINESTRING
#&gt; dimension:      XY
#&gt; bbox:           xmin: 0.02397248 ymin: 0.1355328 xmax: 0.3947794 ymax: 0.9765345
#&gt; epsg (SRID):    NA
#&gt; proj4string:    NA
#&gt;     id  use cars_per_hour                      lnstr_sfc
#&gt; 1 hwy1 road            10 LINESTRING (0.02397248 0.13...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(lnstr_sf)</code></pre></div>
<pre><code>#&gt; [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<p>There are many methods available in the <code>sf</code> package, to find out use</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">methods</span>(<span class="dt">class=</span><span class="st">&quot;sf&quot;</span>)</code></pre></div>
<pre><code>#&gt;  [1] [                     [[&lt;-                  $&lt;-                  
#&gt;  [4] aggregate             as.data.frame         cbind                
#&gt;  [7] coerce                extent                extract              
#&gt; [10] identify              initialize            mask                 
#&gt; [13] merge                 plot                  print                
#&gt; [16] rasterize             rbind                 show                 
#&gt; [19] slotsFromS3           st_agr                st_agr&lt;-             
#&gt; [22] st_as_sf              st_bbox               st_boundary          
#&gt; [25] st_buffer             st_cast               st_centroid          
#&gt; [28] st_collection_extract st_convex_hull        st_coordinates       
#&gt; [31] st_crs                st_crs&lt;-              st_difference        
#&gt; [34] st_geometry           st_geometry&lt;-         st_intersection      
#&gt; [37] st_is                 st_line_merge         st_node              
#&gt; [40] st_point_on_surface   st_polygonize         st_precision         
#&gt; [43] st_segmentize         st_set_precision      st_simplify          
#&gt; [46] st_snap               st_sym_difference     st_transform         
#&gt; [49] st_triangulate        st_union              st_voronoi           
#&gt; [52] st_wrap_dateline      st_write              st_zm                
#&gt; see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>Here are some of the other highlights of <code>sf</code> you might be interested in:</p>
<ul>
<li><p>provides <strong>fast</strong> I/O, particularly relevant for large files</p></li>
<li><p>directly reads from and writes to spatial <strong>databases</strong> such as PostGIS</p></li>
<li><p>stay tuned for a new <code>ggplot</code> release that will be able to read and plot the <code>sf</code> format without the need of conversion to a data frame, like the <code>sp</code> format</p></li>
</ul>
<p>Note that <code>sp</code> and <code>sf</code> are not the only way spatial objects are conceptualized in R. Other spatial packages may use their own class definitions for spatial data (for example <code>spatstat</code>). Usuallly you can find functions that convert <code>sp</code> and increasingly <code>sf</code> objects to and from these formats.</p>
<blockquote>
<h3>
Challenge
</h3>
<p>Similarly to the example above generate a Point object in R. Use both, the <code>sp</code> and the <code>sf</code> “approach”.</p>
<ol style="list-style-type: decimal">
<li>Create a matrix <code>pts</code> of random numbers with two columns and as many rows as you like. These are your points.</li>
<li>Create a dataframe <code>attrib_df</code> with the same number of rows as your <code>pts</code> matrix and a column that holds an attribute. You can make up any attribute.</li>
<li>Use the appropriate commands and <code>pts</code> to create</li>
</ol>
<ul>
<li>a <code>SpatialPointsDataFrame</code> and</li>
<li>an <code>sf</code> object with a gemoetry column of class <code>sfc_POINT</code>.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Try to subset your spatial object using the attribute you have added and the way you are used to from regular data frames.</li>
<li>How do you determine the bounding box of your spatial object?</li>
</ol>
</blockquote>
</div>
</div>
<div id="creating-a-spatial-object-from-a-latlon-table" class="section level2">
<h2><span class="header-section-number">1.2</span> Creating a spatial object from a lat/lon table</h2>
<p>Often in your research might have a spreadsheet that contains latitude, longitude and perhaps some attribute values. You know how to read the spreadsheet into a data frame with <code>read.table</code> or <code>read.csv</code>. We can then very easily convert the table into a spatial object in R.</p>
<p>A <code>SpatialPointsDataFrame</code> object can be created directly from a table by specifying which columns contain the coordinates. This can be done in one step by using the <code>coordinates()</code> function. As mentioned above this function can be used not only to retrieve spatial coordinates but also to set them, which is done in R fashion with:</p>
<pre><code>coordinates(myDataframe) &lt;- value</code></pre>
<p><code>value</code> can have different forms – in this context needs to be a character vector which specifies the data frame’s columns for the longitude and latitude (x,y) coordinates.</p>
<p>If we use this on a data frame it automatically converts the data frame object into a <code>SpatialPointsDataFrame</code> object.</p>
<p>An <code>sf</code> object can be created from a data frame in the following way. We take advantage of the <code>st_as_sf()</code> function which converts any foreign object into an <code>sf</code> object. Similarly to above, it requires an argument <code>coords</code>, which in the case of point data needs to be a vector that specifies the data frame’s columns for the longitude and latitude (x,y) coordinates.</p>
<pre><code>my_sf_object &lt;- st_as_sf(myDataframe, coords)</code></pre>
<p>Note that <code>coordinates()</code> replaces the original data frame, while <code>st_as_sf()</code> creates a new object and leaves the original data frame untouched.</p>
<p>We use <code>read.csv()</code> to read <code>philly_homicides.csv</code> into a dataframe in R and name it <code>ph_df</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ph_df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;data/philly_homicides.csv&quot;</span>)
<span class="kw">head</span>(ph_df)</code></pre></div>
<pre><code>#&gt;   DC_DIST SECTOR DISPATCH_DATE DISPATCH_TIME          LOCATION_BLOCK
#&gt; 1      22      1    2014-09-14      16:00:00 1800 BLOCK W MONTGOMERY
#&gt; 2       1      B    2006-01-14      00:00:00   2000 BLOCK MIFFLIN ST
#&gt; 3       1      B    2006-04-01      16:05:00   S 22ND ST /SNYDER AVE
#&gt; 4       1      B    2006-05-10      11:13:00   2100 BLOCK MC KEAN ST
#&gt; 5       1      E    2006-07-01      12:42:00   2100 BLOCK S HICKS ST
#&gt; 6       1      F    2006-07-09      19:13:00   1800 BLOCK SNYDER AVE
#&gt;   UCR_GENERAL OBJ_ID    TEXT_GENERAL_CODE   POINT_X  POINT_Y
#&gt; 1         100      1  Homicide - Criminal -75.15680 39.98804
#&gt; 2         100      1  Homicide - Criminal -75.17873 39.92801
#&gt; 3         100      1  Homicide - Criminal -75.18275 39.92607
#&gt; 4         100      1  Homicide - Criminal -75.18092 39.92704
#&gt; 5         100      1  Homicide - Criminal -75.17204 39.92463
#&gt; 6         100      1 Homicide - Criminal  -75.17612 39.92517</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(ph_df)</code></pre></div>
<pre><code>#&gt; [1] &quot;data.frame&quot;</code></pre>
<p>We convert the <code>ph_df</code> data frame into an <code>sf</code> object with <code>st_as_sf()</code></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ph_sf &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(ph_df , <span class="dt">coords =</span> <span class="kw">c</span>(<span class="st">&quot;POINT_X&quot;</span>, <span class="st">&quot;POINT_Y&quot;</span>))
<span class="kw">class</span>(ph_sf)</code></pre></div>
<pre><code>#&gt; [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(ph_sf)</code></pre></div>
<pre><code>#&gt; Simple feature collection with 6 features and 8 fields
#&gt; geometry type:  POINT
#&gt; dimension:      XY
#&gt; bbox:           xmin: -75.18275 ymin: 39.92463 xmax: -75.1568 ymax: 39.98804
#&gt; epsg (SRID):    NA
#&gt; proj4string:    NA
#&gt;   DC_DIST SECTOR DISPATCH_DATE DISPATCH_TIME          LOCATION_BLOCK
#&gt; 1      22      1    2014-09-14      16:00:00 1800 BLOCK W MONTGOMERY
#&gt; 2       1      B    2006-01-14      00:00:00   2000 BLOCK MIFFLIN ST
#&gt; 3       1      B    2006-04-01      16:05:00   S 22ND ST /SNYDER AVE
#&gt; 4       1      B    2006-05-10      11:13:00   2100 BLOCK MC KEAN ST
#&gt; 5       1      E    2006-07-01      12:42:00   2100 BLOCK S HICKS ST
#&gt; 6       1      F    2006-07-09      19:13:00   1800 BLOCK SNYDER AVE
#&gt;   UCR_GENERAL OBJ_ID    TEXT_GENERAL_CODE                   geometry
#&gt; 1         100      1  Homicide - Criminal  POINT (-75.1568 39.98804)
#&gt; 2         100      1  Homicide - Criminal POINT (-75.17873 39.92801)
#&gt; 3         100      1  Homicide - Criminal POINT (-75.18275 39.92607)
#&gt; 4         100      1  Homicide - Criminal POINT (-75.18092 39.92704)
#&gt; 5         100      1  Homicide - Criminal POINT (-75.17204 39.92463)
#&gt; 6         100      1 Homicide - Criminal  POINT (-75.17612 39.92517)</code></pre>
<p>Alternatively, we convert the <code>ph_df</code> data frame into a spatial object with using the <code>coordinates</code> function and check with <code>class(ph_df)</code>again to examine which object class the table belongs to now.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">coordinates</span>(ph_df) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;POINT_X&quot;</span>, <span class="st">&quot;POINT_Y&quot;</span>)
<span class="kw">class</span>(ph_df) <span class="co"># !!</span></code></pre></div>
<pre><code>#&gt; [1] &quot;SpatialPointsDataFrame&quot;
#&gt; attr(,&quot;package&quot;)
#&gt; [1] &quot;sp&quot;</code></pre>
<p><strong>A brief, but important word about projection:</strong></p>
<p>Note that both the <code>SpatialPointsDataFrame</code> and the <code>sf</code> POINTS object you just created <strong>do not</strong> have a projection defined. It is ok to plot, but be aware that for any meaningful spatial operation you will need to define a projection.</p>
<p>This is how it’s done:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">is.projected</span>(ph_df) <span class="co"># see if a projection is defined  </span></code></pre></div>
<pre><code>#&gt; [1] NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">proj4string</span>(ph_df) &lt;-<span class="st"> </span><span class="kw">CRS</span>(<span class="st">&quot;+init=epsg:4326&quot;</span>) <span class="co"># this is WGS84</span>
<span class="kw">is.projected</span>(ph_df) <span class="co"># voila! hm. wait a minute..</span></code></pre></div>
<pre><code>#&gt; [1] FALSE</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># For the `sf` object you want to use </span>
<span class="kw">st_crs</span>(ph_sf)</code></pre></div>
<pre><code>#&gt; Coordinate Reference System: NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_crs</span>(ph_sf) &lt;-<span class="st"> </span><span class="dv">4326</span> <span class="co"># we can use EPSG as numeric here</span>
<span class="kw">st_crs</span>(ph_sf)</code></pre></div>
<pre><code>#&gt; Coordinate Reference System:
#&gt;   EPSG: 4326 
#&gt;   proj4string: &quot;+proj=longlat +datum=WGS84 +no_defs&quot;</code></pre>
<p>We will save this for later use. (Note that this will likely generate an error message. By default <code>sf_write</code> checks if the file already exists, and if so it will not overwrite it. If you want to force it to overwrite use the option <code>delete_layer = TRUE</code>.)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_write</span>(ph_sf, <span class="st">&quot;data/PhillyHomicides&quot;</span>, <span class="dt">driver =</span> <span class="st">&quot;ESRI Shapefile&quot;</span>)

<span class="co"># to save out using writeOGR from rgdal</span>
<span class="co"># note that we need to save the ph_df, which we converted to sp object!</span>
<span class="co"># writeOGR(ph_df, &quot;data/PhillyHomicides&quot;, &quot;PhillyHomcides&quot;, driver = &quot;ESRI Shapefile&quot;)</span>
<span class="co"># to force save:</span>
<span class="co"># writeOGR(ph_df, &quot;data/PhillyHomicides&quot;, &quot;PhillyHomcides&quot;, driver = &quot;ESRI Shapefile&quot;, overwrite_layer = TRUE)</span></code></pre></div>
</div>
<div id="loading-shape-files-into-r" class="section level2">
<h2><span class="header-section-number">1.3</span> Loading shape files into R</h2>
<div id="how-to-work-with-rgdal" class="section level3">
<h3><span class="header-section-number">1.3.1</span> How to work with <code>rgdal</code></h3>
<p>In order to read spatial data into R and turn them into <code>Spatial*</code> family objects we rely on the <code>rgdal</code> package. It provides us direct access to the powerful <a href="http://gdal.org">GDAL library</a> from within R.</p>
<p>We can read in and write out spatial data using:</p>
<pre><code>readOGR() and writeOGR() (for vector)  
readGDAL() and writeGDAL() (for raster/grids)</code></pre>
<p>The parameters provided for each function vary depending on the exact spatial file type you are reading. We will take an ESRI shapefile as an example. A shapefile - as you know - <a href="https://en.wikipedia.org/wiki/Shapefile">consists of various files of the same name, but with different extensions</a>. They should all be in one directory and that is what R expects.</p>
<p>When reading in a shapefile, <code>readOGR()</code> requires the following two arguments:</p>
<pre><code>datasource name (dsn)  # the path to the folder that contains the files
                       # this is a path to the folder, not a filename!
layer name (layer)     # the shapefile name WITHOUT extension
                       # this is not a path but just the name of the file!</code></pre>
<p>Setting these arguments correctly can be cause of much headache for beginners, so let me spell it out:</p>
<ul>
<li><p>Firstly, you obviously need to know the name of shapefile.</p></li>
<li><p>Secondly, you need to know the name and location of the folder that contains all the shapefile parts.</p></li>
<li><p>Lastly, <code>readOGR</code> only reads the file and dumps it on your screen. But similarly when reading csv tables you want to actually work with the file, so you need to assign it to an R object.</p></li>
</ul>
<p>Now let’s do this.</p>
<p>We load the <code>rgdal</code> package and read <code>PhillyTotalPopHHinc</code> into an object called <code>philly</code>. We can also examine the object, for example with <code>summary()</code> or <code>class()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rgdal)
philly_sp &lt;-<span class="st"> </span><span class="kw">readOGR</span>(<span class="st">&quot;data/Philly/&quot;</span>, <span class="st">&quot;PhillyTotalPopHHinc&quot;</span>) </code></pre></div>
<pre><code>#&gt; OGR data source with driver: ESRI Shapefile 
#&gt; Source: &quot;/Users/cengel/Anthro/R_Class/R_Workshops/R-spatial/data/Philly&quot;, layer: &quot;PhillyTotalPopHHinc&quot;
#&gt; with 384 features
#&gt; It has 17 fields</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># side note: unlike read.csv readOGR does not understand the ~ as valid element of a path. This (on Mac) will not work:</span>
<span class="co"># philly &lt;- readOGR(&quot;~/Desktop/R-data-viz/data/Philly/&quot;, &quot;PhillyTotalPopHHinc&quot;)</span>
<span class="kw">summary</span>(philly_sp)</code></pre></div>
<pre><code>#&gt; Object of class SpatialPolygonsDataFrame
#&gt; Coordinates:
#&gt;         min       max
#&gt; x 1739496.5 1764029.7
#&gt; y  457343.7  490544.9
#&gt; Is projected: TRUE 
#&gt; proj4string :
#&gt; [+proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96 +x_0=0
#&gt; +y_0=0 +ellps=GRS80 +units=m +no_defs]
#&gt; Data attributes:
#&gt;  STATEFP10 COUNTYFP10   TRACTCE10          GEOID10        NAME10   
#&gt;  42:384    101:384    000100 :  1   42101000100:  1   1      :  1  
#&gt;                       000200 :  1   42101000200:  1   10.01  :  1  
#&gt;                       000300 :  1   42101000300:  1   10.02  :  1  
#&gt;                       000401 :  1   42101000401:  1   100    :  1  
#&gt;                       000402 :  1   42101000402:  1   101    :  1  
#&gt;                       000500 :  1   42101000500:  1   102    :  1  
#&gt;                       (Other):378   (Other)    :378   (Other):378  
#&gt;               NAMELSAD10   MTFCC10    FUNCSTAT10    ALAND10        
#&gt;  Census Tract 1    :  1   G5020:384   S:384      Min.   :   99958  
#&gt;  Census Tract 10.01:  1                          1st Qu.:  397457  
#&gt;  Census Tract 10.02:  1                          Median :  600362  
#&gt;  Census Tract 100  :  1                          Mean   :  904482  
#&gt;  Census Tract 101  :  1                          3rd Qu.:  955452  
#&gt;  Census Tract 102  :  1                          Max.   :17228698  
#&gt;  (Other)           :378                                            
#&gt;     AWATER10             INTPTLAT10         INTPTLON10 
#&gt;  Min.   :      0   +39.8798897:  1   -074.9667387:  1  
#&gt;  1st Qu.:      0   +39.8898768:  1   -074.9702250:  1  
#&gt;  Median :      0   +39.8904539:  1   -074.9742967:  1  
#&gt;  Mean   :  58045   +39.8988328:  1   -074.9781805:  1  
#&gt;  3rd Qu.:      0   +39.9024981:  1   -074.9789137:  1  
#&gt;  Max.   :3463789   +39.9051799:  1   -074.9805151:  1  
#&gt;                    (Other)    :378   (Other)     :378  
#&gt;            GISJOIN      Shape_area         Shape_len        medHHinc     
#&gt;  G4201010000100:  1   Min.   :  105512   Min.   : 1321   Min.   :  9286  
#&gt;  G4201010000200:  1   1st Qu.:  398512   1st Qu.: 2734   1st Qu.: 24946  
#&gt;  G4201010000300:  1   Median :  601061   Median : 3426   Median : 35365  
#&gt;  G4201010000401:  1   Mean   :  962528   Mean   : 4239   Mean   : 38509  
#&gt;  G4201010000402:  1   3rd Qu.:  966639   3rd Qu.: 4603   3rd Qu.: 49474  
#&gt;  G4201010000500:  1   Max.   :20692491   Max.   :30881   Max.   :130139  
#&gt;  (Other)       :378                                      NA&#39;s   :9       
#&gt;     totalPop   
#&gt;  Min.   :   0  
#&gt;  1st Qu.:2799  
#&gt;  Median :3914  
#&gt;  Mean   :3974  
#&gt;  3rd Qu.:5111  
#&gt;  Max.   :8322  
#&gt; </code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(philly_sp)</code></pre></div>
<pre><code>#&gt; [1] &quot;SpatialPolygonsDataFrame&quot;
#&gt; attr(,&quot;package&quot;)
#&gt; [1] &quot;sp&quot;</code></pre>
<p>Let’s check out the attribute data and plot a subset of polygons with a median household income (<code>medHHinc</code>) of over 60000 on top of the plot of the entire city.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">names</span>(philly_sp)</code></pre></div>
<pre><code>#&gt;  [1] &quot;STATEFP10&quot;  &quot;COUNTYFP10&quot; &quot;TRACTCE10&quot;  &quot;GEOID10&quot;    &quot;NAME10&quot;    
#&gt;  [6] &quot;NAMELSAD10&quot; &quot;MTFCC10&quot;    &quot;FUNCSTAT10&quot; &quot;ALAND10&quot;    &quot;AWATER10&quot;  
#&gt; [11] &quot;INTPTLAT10&quot; &quot;INTPTLON10&quot; &quot;GISJOIN&quot;    &quot;Shape_area&quot; &quot;Shape_len&quot; 
#&gt; [16] &quot;medHHinc&quot;   &quot;totalPop&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(philly_sp)</code></pre></div>
<pre><code>#&gt;   STATEFP10 COUNTYFP10 TRACTCE10     GEOID10 NAME10          NAMELSAD10
#&gt; 0        42        101    036301 42101036301 363.01 Census Tract 363.01
#&gt; 1        42        101    036400 42101036400    364    Census Tract 364
#&gt; 2        42        101    036600 42101036600    366    Census Tract 366
#&gt; 3        42        101    034803 42101034803 348.03 Census Tract 348.03
#&gt; 4        42        101    034702 42101034702 347.02 Census Tract 347.02
#&gt; 5        42        101    036202 42101036202 362.02 Census Tract 362.02
#&gt;   MTFCC10 FUNCSTAT10 ALAND10 AWATER10  INTPTLAT10   INTPTLON10
#&gt; 0   G5020          S 2322732    66075 +40.0895349 -074.9667387
#&gt; 1   G5020          S 4501110     8014 +40.1127747 -074.9789137
#&gt; 2   G5020          S 1004313  1426278 +39.9470272 -075.1404472
#&gt; 3   G5020          S 1271533     8021 +40.0619427 -075.0023705
#&gt; 4   G5020          S 1016206        0 +40.0570427 -075.0283288
#&gt; 5   G5020          S 1116115     2329 +40.0838623 -074.9781805
#&gt;          GISJOIN Shape_area Shape_len medHHinc totalPop
#&gt; 0 G4201010036301    2388806  6850.541    54569     3695
#&gt; 1 G4201010036400    4509124 10567.331       NA      703
#&gt; 2 G4201010036600    2430591  9256.983   130139     1643
#&gt; 3 G4201010034803    1279556  4927.632    56667     4390
#&gt; 4 G4201010034702    1016207  5919.885    69981     3807
#&gt; 5 G4201010036202    1118443  5899.099    61513     6138</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(philly_sp)
philly_sp_rich &lt;-<span class="st"> </span><span class="kw">subset</span>(philly_sp, medHHinc <span class="op">&gt;</span><span class="st"> </span><span class="dv">60000</span>)
<span class="kw">plot</span>(philly_sp_rich, <span class="dt">add=</span>T, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="R-spatial_files/figure-html/plot-shp-sp-1.png" width="672" /></p>
<p>GDAL supports over 200 <a href="http://www.gdal.org/formats_list.html">raster formats</a> and <a href="http://www.gdal.org/ogr_formats.html">vector formats</a>. Use <code>ogrDrivers()</code> and <code>gdalDrivers()</code> (without arguments) to find out which formats your <code>rgdal</code> install can handle.</p>
</div>
<div id="how-to-do-this-in-sf" class="section level3">
<h3><span class="header-section-number">1.3.2</span> How to do this in <code>sf</code></h3>
<p><code>sf</code> also relies on GDAL, but we don’t need to load a separate R library to read data in. We can use <code>st_read()</code>, which simply takes the path of the directory with the shapefile as argument.</p>
<p>So let’s do the same as above using the <code>sf</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># read in</span>
philly_sf &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&quot;data/Philly/&quot;</span>)</code></pre></div>
<pre><code>#&gt; Reading layer `PhillyTotalPopHHinc&#39; from data source `/Users/cengel/Anthro/R_Class/R_Workshops/R-spatial/data/Philly&#39; using driver `ESRI Shapefile&#39;
#&gt; Simple feature collection with 384 features and 17 fields
#&gt; geometry type:  MULTIPOLYGON
#&gt; dimension:      XY
#&gt; bbox:           xmin: 1739497 ymin: 457343.7 xmax: 1764030 ymax: 490544.9
#&gt; epsg (SRID):    NA
#&gt; proj4string:    +proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># take a look at what we&#39;ve got</span>
<span class="kw">names</span>(philly_sf)</code></pre></div>
<pre><code>#&gt;  [1] &quot;STATEFP10&quot;  &quot;COUNTYFP10&quot; &quot;TRACTCE10&quot;  &quot;GEOID10&quot;    &quot;NAME10&quot;    
#&gt;  [6] &quot;NAMELSAD10&quot; &quot;MTFCC10&quot;    &quot;FUNCSTAT10&quot; &quot;ALAND10&quot;    &quot;AWATER10&quot;  
#&gt; [11] &quot;INTPTLAT10&quot; &quot;INTPTLON10&quot; &quot;GISJOIN&quot;    &quot;Shape_area&quot; &quot;Shape_len&quot; 
#&gt; [16] &quot;medHHinc&quot;   &quot;totalPop&quot;   &quot;geometry&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># note the added geometry column, as compared to:</span>
<span class="kw">names</span>(philly_sp)</code></pre></div>
<pre><code>#&gt;  [1] &quot;STATEFP10&quot;  &quot;COUNTYFP10&quot; &quot;TRACTCE10&quot;  &quot;GEOID10&quot;    &quot;NAME10&quot;    
#&gt;  [6] &quot;NAMELSAD10&quot; &quot;MTFCC10&quot;    &quot;FUNCSTAT10&quot; &quot;ALAND10&quot;    &quot;AWATER10&quot;  
#&gt; [11] &quot;INTPTLAT10&quot; &quot;INTPTLON10&quot; &quot;GISJOIN&quot;    &quot;Shape_area&quot; &quot;Shape_len&quot; 
#&gt; [16] &quot;medHHinc&quot;   &quot;totalPop&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># plot works differently here:</span>
<span class="kw">plot</span>(philly_sf)</code></pre></div>
<pre><code>#&gt; Warning: plotting the first 10 out of 17 attributes; use max.plot = 17 to
#&gt; plot all</code></pre>
<p><img src="R-spatial_files/figure-html/read-shp-sf-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># to do the same as above we need to directly print the geometry column</span>
<span class="kw">st_geometry</span>(philly_sf)        <span class="co"># use this method to retreive geometry</span></code></pre></div>
<pre><code>#&gt; Geometry set for 384 features 
#&gt; geometry type:  MULTIPOLYGON
#&gt; dimension:      XY
#&gt; bbox:           xmin: 1739497 ymin: 457343.7 xmax: 1764030 ymax: 490544.9
#&gt; epsg (SRID):    NA
#&gt; proj4string:    +proj=aea +lat_1=29.5 +lat_2=45.5 +lat_0=37.5 +lon_0=-96 +x_0=0 +y_0=0 +ellps=GRS80 +units=m +no_defs
#&gt; First 5 geometries:</code></pre>
<pre><code>#&gt; MULTIPOLYGON (((1763647 484837.3, 1763473 48519...</code></pre>
<pre><code>#&gt; MULTIPOLYGON (((1761348 489213.5, 1761372 48918...</code></pre>
<pre><code>#&gt; MULTIPOLYGON (((1752887 468814.9, 1752808 46863...</code></pre>
<pre><code>#&gt; MULTIPOLYGON (((1761207 482777.8, 1761634 48258...</code></pre>
<pre><code>#&gt; MULTIPOLYGON (((1759301 482266.6, 1759120 48186...</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(<span class="kw">st_geometry</span>(philly_sf))

<span class="co"># subset the familar way</span>
philly_sf_rich &lt;-<span class="st"> </span><span class="kw">subset</span>(philly_sf, medHHinc <span class="op">&gt;</span><span class="st"> </span><span class="dv">60000</span>)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(philly_sf_rich), <span class="dt">add=</span>T, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="R-spatial_files/figure-html/read-shp-sf-2.png" width="672" /></p>
</div>
</div>
<div id="raster-data-in-r" class="section level2">
<h2><span class="header-section-number">1.4</span> Raster data in R</h2>
<p>Raster files, as you might know, have a much more compact data structure than vectors. Because of their regular structure the coordinates do not need to be recorded for each pixel or cell in the rectangular extent. A raster is defined by:</p>
<ul>
<li>a CRS</li>
<li>coordinates of its origin</li>
<li>a distance or cell size in each direction</li>
<li>a dimension or numbers of cells in each direction</li>
<li>an array of cell values</li>
</ul>
<p>Given this structure, coordinates for any cell can be computed and don’t need to be stored.</p>
<p>The <code>raster</code> package<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a> is a major extension of spatial data classes to access large rasters and in particular to process very large files. It includes object classes for <code>RasterLayer</code>, <code>RasterStacks</code>, and <code>RasterBricks</code>, functions for converting among these classes, and operators for computations on the raster data. Conversion from <code>sp</code> type objects into <code>raster</code> type objects is possible.</p>
<p>If we wanted to do create a raster object from scratch we would do the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># specify the RasterLayer with the following parameters:</span>
<span class="co"># - minimum x coordinate (left border)</span>
<span class="co"># - minimum y coordinate (bottom border)</span>
<span class="co"># - maximum x coordinate (right border)</span>
<span class="co"># - maximum y coordinate (top border)</span>
<span class="co"># - resolution (cell size) in each dimension</span>
r &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="dt">xmn=</span><span class="op">-</span><span class="fl">0.5</span>, <span class="dt">ymn=</span><span class="op">-</span><span class="fl">0.5</span>, <span class="dt">xmx=</span><span class="fl">4.5</span>, <span class="dt">ymx=</span><span class="fl">4.5</span>, <span class="dt">resolution=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))
r</code></pre></div>
<pre><code>#&gt; class       : RasterLayer 
#&gt; dimensions  : 5, 5, 25  (nrow, ncol, ncell)
#&gt; resolution  : 1, 1  (x, y)
#&gt; extent      : -0.5, 4.5, -0.5, 4.5  (xmin, xmax, ymin, ymax)
#&gt; coord. ref. : +proj=longlat +datum=WGS84 +ellps=WGS84 +towgs84=0,0,0</code></pre>
<p>Note that this raster object <strong>has a CRS defined!</strong> If the crs argument is missing when creating the Raster object, the x coordinates are within -360 and 360 and the y coordinates are within -90 and 90, the WGS84 projection is used by default!</p>
<p>Good to know.</p>
<p>To add some values to the cells we could the following.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(r)</code></pre></div>
<pre><code>#&gt; [1] &quot;RasterLayer&quot;
#&gt; attr(,&quot;package&quot;)
#&gt; [1] &quot;raster&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">r &lt;-<span class="st"> </span><span class="kw">setValues</span>(r, <span class="kw">runif</span>(<span class="dv">25</span>))
<span class="kw">class</span>(r)</code></pre></div>
<pre><code>#&gt; [1] &quot;RasterLayer&quot;
#&gt; attr(,&quot;package&quot;)
#&gt; [1] &quot;raster&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(r); <span class="kw">points</span>(<span class="kw">coordinates</span>(r), <span class="dt">pch=</span><span class="dv">3</span>)</code></pre></div>
<p><img src="R-spatial_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>(See the <a href="https://cran.r-project.org/web/packages/rasterVis/index.html"><code>rasterVis</code> package</a> for more advanced plotting of <code>Raster*</code> objects.)</p>
<p>RasterLayer objects can also be created from a matrix.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(volcano)</code></pre></div>
<pre><code>#&gt; [1] &quot;matrix&quot;</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">volcano.r &lt;-<span class="st"> </span><span class="kw">raster</span>(volcano)
<span class="kw">class</span>(volcano.r)</code></pre></div>
<pre><code>#&gt; [1] &quot;RasterLayer&quot;
#&gt; attr(,&quot;package&quot;)
#&gt; [1] &quot;raster&quot;</code></pre>
<p>And to read in a raster file we can use the <code>raster()</code> function. This raster is generated as part of the <a href="https://www.neonscience.org/field-sites/field-sites-map/HARV">NEON Harvard Forest field site</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(raster)
HARV &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&quot;data/HARV_RGB_Ortho.tif&quot;</span>)</code></pre></div>
<p>Typing the name of the object will give us what’s in there:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">HARV</code></pre></div>
<pre><code>#&gt; class       : RasterLayer 
#&gt; band        : 1  (of  3  bands)
#&gt; dimensions  : 2317, 3073, 7120141  (nrow, ncol, ncell)
#&gt; resolution  : 0.25, 0.25  (x, y)
#&gt; extent      : 731998.5, 732766.8, 4712956, 4713536  (xmin, xmax, ymin, ymax)
#&gt; coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
#&gt; data source : /Users/cengel/Anthro/R_Class/R_Workshops/R-spatial/data/HARV_RGB_Ortho.tif 
#&gt; names       : HARV_RGB_Ortho 
#&gt; values      : 0, 255  (min, max)</code></pre>
<p>We can plot it like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(HARV)</code></pre></div>
<p><img src="R-spatial_files/figure-html/plot-raster-1.png" width="672" /></p>
<p>We can find out about the Coordinate Reference System with this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">crs</span>(HARV)</code></pre></div>
<pre><code>#&gt; CRS arguments:
#&gt;  +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84
#&gt; +towgs84=0,0,0</code></pre>
<p>See what you can do with such an object:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">methods</span>(<span class="dt">class=</span><span class="kw">class</span>(HARV))</code></pre></div>
<pre><code>#&gt;   [1] !                !=               [                [[              
#&gt;   [5] [&lt;-              %in%             ==               $               
#&gt;   [9] $&lt;-              addLayer         aggregate        all.equal       
#&gt;  [13] area             Arith            as.array         as.data.frame   
#&gt;  [17] as.factor        as.integer       as.list          as.logical      
#&gt;  [21] as.matrix        as.raster        as.vector        asFactor        
#&gt;  [25] atan2            bandnr           barplot          bbox            
#&gt;  [29] boundaries       boxplot          brick            buffer          
#&gt;  [33] calc             cellStats        clamp            click           
#&gt;  [37] clump            coerce           colSums          Compare         
#&gt;  [41] contour          coordinates      corLocal         cover           
#&gt;  [45] crop             crosstab         cut              cv              
#&gt;  [49] density          dim              dim&lt;-            direction       
#&gt;  [53] disaggregate     distance         extend           extent          
#&gt;  [57] extract          flip             focal            freq            
#&gt;  [61] getValues        getValuesBlock   getValuesFocal   gridDistance    
#&gt;  [65] head             hist             image            interpolate     
#&gt;  [69] intersect        is.factor        is.finite        is.infinite     
#&gt;  [73] is.na            is.nan           isLonLat         KML             
#&gt;  [77] labels           layerize         length           levels          
#&gt;  [81] levels&lt;-         lines            localFun         log             
#&gt;  [85] Logic            mask             match            Math            
#&gt;  [89] Math2            maxValue         mean             merge           
#&gt;  [93] minValue         modal            mosaic           names           
#&gt;  [97] names&lt;-          ncell            ncol             nlayers         
#&gt; [101] nrow             origin           origin&lt;-         overlay         
#&gt; [105] persp            plot             predict          print           
#&gt; [109] proj4string      proj4string&lt;-    quantile         raster          
#&gt; [113] rasterize        readAll          readStart        readStop        
#&gt; [117] reclassify       res              resample         RGB             
#&gt; [121] rotate           rowSums          sampleRandom     sampleRegular   
#&gt; [125] sampleStratified scale            select           setMinMax       
#&gt; [129] setValues        shift            show             spplot          
#&gt; [133] stack            stackSelect      subs             subset          
#&gt; [137] Summary          summary          t                tail            
#&gt; [141] text             trim             unique           update          
#&gt; [145] values           values&lt;-         Which            which.max       
#&gt; [149] which.min        writeRaster      writeStart       writeStop       
#&gt; [153] writeValues      xmax             xmin             xres            
#&gt; [157] ymax             ymin             yres             zonal           
#&gt; [161] zoom            
#&gt; see &#39;?methods&#39; for accessing help and source code</code></pre>
<p>We can explore the distribution of values contained within our raster using the hist() function which produces a histogram. Histograms are often useful in identifying outliers and bad data values in our raster data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(HARV)</code></pre></div>
<pre><code>#&gt; Warning in .hist1(x, maxpixels = maxpixels, main = main, plot = plot, ...):
#&gt; 1% of the raster cells were used. 100000 values used.</code></pre>
<p><img src="R-spatial_files/figure-html/n-hist-1.png" width="672" /></p>
<p>Notice that an warning message is thrown when R creates the histogram.</p>
<p>This warning is caused by the default maximum pixels value of 100,000 associated with the hist function. This maximum value is to ensure processing efficiency as our data become larger!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ncell</span>(HARV)</code></pre></div>
<pre><code>#&gt; [1] 7120141</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">hist</span>(HARV,
     <span class="dt">maxpixels =</span> <span class="kw">ncell</span>(HARV))</code></pre></div>
<p><img src="R-spatial_files/figure-html/n-hist-allvals-1.png" width="672" /></p>
<p>At times it may be useful to explore raster metadata before loading them into R. This can be done with:</p>
<pre><code>GDALinfo(&quot;path-to-raster-here&quot;) </code></pre>
<p>A raster dataset can contain one or more bands. We can view the number of bands in a raster using the <code>nlayers()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">nlayers</span>(HARV)</code></pre></div>
<pre><code>#&gt; [1] 1</code></pre>
<p>We can use the <code>raster()</code> function to import one single band from a <em>single</em> <strong>OR</strong> from a <em>multi-band</em> raster. For multi-band raster, we can specify which band we want to read in.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">HARV_Band2 &lt;-
<span class="st">  </span><span class="kw">raster</span>(<span class="st">&quot;data/HARV_RGB_Ortho.tif&quot;</span>, <span class="dt">band =</span> <span class="dv">2</span>)

<span class="kw">plot</span>(HARV_Band2)</code></pre></div>
<p><img src="R-spatial_files/figure-html/one-multiband-1.png" width="672" /></p>
<p>To bring in all bands of a multi-band raster, we use the <code>stack()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">HARV_stack &lt;-
<span class="st">  </span><span class="kw">stack</span>(<span class="st">&quot;data/HARV_RGB_Ortho.tif&quot;</span>)

<span class="co"># how many layers?</span>
<span class="kw">nlayers</span>(HARV_stack)</code></pre></div>
<pre><code>#&gt; [1] 3</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># view attributes of stack object</span>
HARV_stack</code></pre></div>
<pre><code>#&gt; class       : RasterStack 
#&gt; dimensions  : 2317, 3073, 7120141, 3  (nrow, ncol, ncell, nlayers)
#&gt; resolution  : 0.25, 0.25  (x, y)
#&gt; extent      : 731998.5, 732766.8, 4712956, 4713536  (xmin, xmax, ymin, ymax)
#&gt; coord. ref. : +proj=utm +zone=18 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0 
#&gt; names       : HARV_RGB_Ortho.1, HARV_RGB_Ortho.2, HARV_RGB_Ortho.3 
#&gt; min values  :                0,                0,                0 
#&gt; max values  :              255,              255,              255</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># what happens when we plot?</span>
<span class="kw">plot</span>(HARV_stack)</code></pre></div>
<p><img src="R-spatial_files/figure-html/stack-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># if we know that it is an RGB multiband raster we can plot them all in one</span>
<span class="kw">plotRGB</span>(HARV_stack)</code></pre></div>
<p><img src="R-spatial_files/figure-html/stack-2.png" width="672" /></p>
<div id="rasterstack-vs-rasterbrick-in-r" class="section level3">
<h3><span class="header-section-number">1.4.1</span> RasterStack vs RasterBrick in R</h3>
<p>The R <code>RasterStack</code> and <code>RasterBrick</code> object types can both store multiple bands. However, how they store each band is different. The bands in a <code>RasterStack</code> are stored as links to raster data that is located somewhere on our computer. A <code>RasterBrick</code> contains all of the objects stored within the actual R object. Since in the <code>RasterBrick</code>, all of the bands are stored within the actual object its object size is much larger than the <code>RasterStack</code> object.</p>
<p>In most cases, we can work with a <code>RasterBrick</code> in the same way we might work with a <code>RasterStack</code>. However, a <code>RasterBrick</code> is often more efficient and faster to process - which is important when working with larger files.</p>
<p>We can turn a <code>RasterStack</code> into a <code>RasterBrick</code> in R by using <code>brick(StackName)</code>. Use the <code>object.size()</code> function to compare stack and brick R objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">object.size</span>(HARV_stack)</code></pre></div>
<pre><code>#&gt; 41712 bytes</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">HARV_brick &lt;-<span class="st"> </span><span class="kw">brick</span>(HARV_stack)
<span class="kw">object.size</span>(HARV_brick)</code></pre></div>
<pre><code>#&gt; 170896376 bytes</code></pre>
<p>A simple grid can be built like this:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># specify the grid topology with the following parameters:</span>
<span class="co"># - the smallest coordinates for each dimension, here: 0,0</span>
<span class="co"># - cell size in each dimension, here: 1,1 </span>
<span class="co"># - number of cells in each dimension, here: 5,5</span>
gtopo &lt;-<span class="st"> </span><span class="kw">GridTopology</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>), <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>), <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">5</span>)) <span class="co"># create the grid</span>
datafr &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="kw">runif</span>(<span class="dv">25</span>)) <span class="co"># make up some data</span>
SpGdf &lt;-<span class="st"> </span><span class="kw">SpatialGridDataFrame</span>(gtopo, datafr) <span class="co"># create the grid data frame</span>
<span class="kw">summary</span>(SpGdf)</code></pre></div>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>R Bivand (2011) <a href="http://geostat-course.org/system/files/monday_slides.pdf">Introduction to representing spatial objects in R</a><a href="intro.html#fnref1">↩</a></p></li>
<li id="fn2"><p>Coordinates should be of type double and will be promoted if not.<a href="intro.html#fnref2">↩</a></p></li>
<li id="fn3"><p>E. Pebesma &amp; R. Bivand (2016)<a href="http://pebesma.staff.ifgi.de/pebesma_sfr.pdf">Spatial data in R: simple features and future perspectives</a><a href="intro.html#fnref3">↩</a></p></li>
<li id="fn4"><p>The <code>geo_join()</code> command from the <a href="https://cran.r-project.org/web/packages/tigris/index.html"><code>tigris</code> package</a> also provides a convenient way to merge a data frame to a spatial data frame.<a href="intro.html#fnref4">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="spatialops.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/cengel/R-spatial/edit/master/01-spatial-data.Rmd",
"text": "Edit"
},
"download": ["R-spatial.pdf", "R-spatial.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
